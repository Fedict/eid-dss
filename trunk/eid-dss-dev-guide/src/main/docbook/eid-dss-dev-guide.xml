<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC 
	"-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<article lang="en">
	<articleinfo>
		<title>FedICT eID Digital Signature Service Developer's Guide</title>
		<subtitle>
			Integrating the eID Digital Signature Service within your
			web applications.
		</subtitle>
		<copyright>
			<year>2009-2010</year>
			<holder>FedICT</holder>
		</copyright>
		<releaseinfo>draft 25 Aug 2010</releaseinfo>
		<authorgroup>
			<author>
				<firstname>Frank</firstname>
				<surname>Cornelis</surname>
				<email>frank.cornelis@fedict.be</email>
			</author>
		</authorgroup>
		<abstract>
			<para>
				This developer's guide serves as an entry point for integrating
				the eID Digital Signature Service in your web applications. The
				target audience are web developers and web application architects.
			</para>
		</abstract>
	</articleinfo>
	<section>
		<title>Introduction</title>
		<para>
			The FedICT eID Digital Signature Service (eID DSS) is a web
			service that can be used by web applications to integrate the
			creation of eID based digital signatures in the business work-flows.
			The eID Digital Signature Service offers different signature profiles
			and protocols. The following sections will highlight the different
			supported signature profiles and protocols.
		</para>
	</section>
	<section>
		<title>eID DSS Browser POST Protocol</title>
		<para>
			The eID Digital Signature Service Protocol POST Profile can be
			used to sign XML based transactions and forms as part of web
			application work-flows. The service offers basic visualization of the
			XML data, and creation of the XMLDSig based XML signature with
			XAdES-X-L v1.4.1 extension. The protocol is very lightweight to ease
			integration within your web applications.
		</para>
		<section>
			<title>Signature Request</title>
			<para>
				Suppose that the web application prepared an XML based
				transaction or form that needs to be signed by the end-user as part
				of some business work-flow. The web application sends the signature
				request to the eID DSS web service using an HTTP POST via the web
				browser of the client. The following POST parameters are available:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						The required
						<code>SignatureRequest</code>
						POST parameter should contain the base-64 encoded XML document
						that needs to be signed.
					</para>
				</listitem>
				<listitem>
					<para>
						The required
						<code>target</code>
						POST parameter should contain the URL of the web application to
						which to send back the signed XML document.
					</para>
				</listitem>
				<listitem>
					<para>
						The optional
						<code>language</code>
						POST parameter should contain the language code which will be used
						by the eID DSS during signature creation.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				The web application can construct the eID DSS Browser POST
				Protocol signature request via the following piece of HTML code.
			</para>
			<programlisting role="XML"><![CDATA[<form id="dss-request-form" method="post" action="https://www.e-contract.be/eid-dss/protocol/simple">
    <input type="hidden" name="SignatureRequest" value="..." />
    <input type="hidden" name="target" value="http://www.some-web-application.be/dss-landing-page" />
    <input type="hidden" name="language" value="nl" />
    <input type="submit" value="Submit" />
</form>
<script type="text/javascript">
    document.getElementById('dss-request-form').submit();
</script>]]></programlisting>
		</section>
		<section>
			<title>Signature Ceremony</title>
			<para>
				The eID Digital Signature Service will guarantee the correct
				execution of the signature ceremony. The signature ceremony is
				presented to the end-user via a web application interface. A first
				screen visualizes the incoming XML document. Here the end-user can
				choose to either sign the XML document, or to cancel the signing
				process. The next screen loads an eID Applet to have the XML
				document signed according to the W3C XMLDSig specification. The XML
				signature also contains a XAdES-X-L v1.4.1 extension in accordance
				with the recommendations of the expert group on the e-Signatures
				Service Directive. At last the end-user's web browser is redirected
				to the originating web application where the signed XML document can
				be processed further.
			</para>
		</section>
		<section>
			<title>Signature Response</title>
			<para>
				After a successful completion of the signature ceremony, the
				eID DSS responds to the web application using an HTTP POST via the
				web browser of the client. The following POST parameters are
				available to the web application.
			</para>
			<itemizedlist>
				<listitem>
					<para>
						The
						<code>SignatureStatus</code>
						parameter contains the result code of the signature operation.
						The
						value of this parameter can be:
						<itemizedlist>
							<listitem>
								<para>
									<code>OK</code>
									in case the signature ceremony was successfully completed. Only
									in this case
									<code>SignatureResponse</code>
									and
									<code>SignatureCertificate</code>
									will
									also be available.
								</para>
							</listitem>
							<listitem>
								<para>
									<code>FILE_FORMAT</code>
									in case the incoming file was not a well-formated XML document.
								</para>
							</listitem>
							<listitem>
								<para>
									<code>USER_CANCELLED</code>
									in case the user cancelled the signature ceremony.
								</para>
							</listitem>
						</itemizedlist>
					</para>
				</listitem>
				<listitem>
					<para>
						<code>SignatureResponse</code>
						contains the base-64 encoded signed XML document.
					</para>
				</listitem>
				<listitem>
					<para>
						<code>SignatureCertificate</code>
						contains the base-64 encoded X509 certificate of the signatory.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				In case the eID Digital Signature Service signs the response
				messages the following additional POST parameters are available to
				the web application. This protocol level signature is created by the
				eID DSS identity itself.
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<code>ServiceSigned</code>
						contains the URL encoded comma-separated list of POST parameters
						signed by the eID DSS itself. Example:
						<code>target,SignatureRequest,SignatureResponse,SignatureCertificate
						</code>
					</para>
				</listitem>
				<listitem>
					<para>
						<code>ServiceSignature</code>
						contains the base64 encoded signature created by the eID DSS
						service itself. This signature can be used by the Relying Party to
						verify the integrity and the authenticity of the signed document.
					</para>
				</listitem>
				<listitem>
					<para>
						<code>ServiceCertificateChainSize</code>
						contains the length as an integer string of the certificate chain
						used by the service to sign the request/response protocol
						parameters.
					</para>
				</listitem>
				<listitem>
					<para>
						<code>ServiceCertificate.n</code>
						contains the base64 encoded n-th certificate of the service
						certificate chain.
						<code>n</code>
						goes from 1 to the size of the certificate chain. The eID DSS end
						entity certificate has number 1.
					</para>
				</listitem>
			</itemizedlist>
		</section>
	</section>
	<appendix>
		<title>eID Digital Signature Service Developer's Guide License</title>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata format="PNG" fileref="cc.logo.large.png"
						scale="100" />
				</imageobject>
			</mediaobject>
			This document has been released under the Creative Commons license.
			<mediaobject>
				<imageobject>
					<imagedata format="PNG" fileref="share.large.png" scale="20" />
				</imageobject>
			</mediaobject>
			You are free to Share â€” to copy, distribute and transmit the work.
			<mediaobject>
				<imageobject>
					<imagedata format="PNG" fileref="by.large.png" scale="20" />
				</imageobject>
			</mediaobject>
			You must attribute the work in the manner specified by the author or
			licensor (but not in any way that suggests that they endorse you or
			your use of the work).
			<mediaobject>
				<imageobject>
					<imagedata format="PNG" fileref="nc.large.png" scale="20" />
				</imageobject>
			</mediaobject>
			You may not use this work for commercial purposes.
			<mediaobject>
				<imageobject>
					<imagedata format="PNG" fileref="nd.large.png" scale="20" />
				</imageobject>
			</mediaobject>
			You may not alter, transform, or build upon this work.
		</para>
		<para>
			More information about the Creative Commons license conditions can be
			found at
			<ulink url="http://creativecommons.org/">Creative Commons organization</ulink>
			.
		</para>
	</appendix>
	<appendix>
		<title>eID Digital Signature Service License</title>
		<para>
			The eID Digital Signature Service source code has been released
			under the GNU LGPL version 3.0.
		</para>
		<para>
			<code>
				This is free software; you can redistribute it and/or modify it
				under the terms of the GNU Lesser General Public License version 3.0
				as published by the Free Software Foundation.
			</code>
		</para>
		<para>
			<code>
				This software is distributed in the hope that it will be
				useful, but WITHOUT ANY WARRANTY; without even the implied warranty
				of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
				Lesser General Public License for more details.
			</code>
		</para>
		<para>
			<code>
				You should have received a copy of the GNU Lesser General
				Public License along with this software; if not, see
				http://www.gnu.org/licenses/.
			</code>
		</para>
	</appendix>
	<appendix>
		<title>Revision history</title>
		<table>
			<title>Revision history</title>
			<tgroup cols="2">
				<colspec colwidth="1*" />
				<colspec colwidth="1*" />
				<colspec colwidth="2*" />
				<thead>
					<row>
						<entry>Date</entry>
						<entry>Author</entry>
						<entry>Description</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>9 Oct 2009</entry>
						<entry>Frank Cornelis</entry>
						<entry>Initial version.</entry>
					</row>
					<row>
						<entry>25 Aug 2010</entry>
						<entry>Frank Cornelis</entry>
						<entry>language parameter.</entry>
					</row>
					<row>
						<entry>27 Aug 2010</entry>
						<entry>Frank Cornelis</entry>
						<entry>Service signature.</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</appendix>
</article>